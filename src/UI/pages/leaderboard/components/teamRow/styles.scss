@use '../../../../styles/colors' as *;
@use '../../../../styles/index' as *;

.teamRow-wrapper {
    transition: background-color 0.2s ease;

    &:last-child {
        .teamRow-container {
            border-bottom: none;
        }
    }

    .teamRow-container {
        text-decoration: none;
        display: grid;
        grid-template-columns: var(--grid-layout);
        padding: $grid-padding-height var(--grid-padding-width);
        gap: 8px;
        align-items: center;
        border-bottom: solid 1px var(--scoreboard-borderColor);
        background-color: var(--scoreboard-BG-row);

        @include mobile {
            gap: 4px;

            &:hover,
            &:focus,
            &:active {
                background-color: var(--scoreboard-BG-row) !important;

                .cell {
                    background-color: var(--scoreboard-BG-cell) !important;
                }
            }
        }

        &:hover {
            background-color: var(--scoreboard-BG-row--hover);

            .cell {
                background-color: var(--scoreboard-BG-cell--hover);
            }
        }

        .cell {
            color: var(--scoreboard-FC-row);
            background-color: var(--scoreboard-BG-row);
            font-size: 30px;
            font-weight: 500;
            padding: 0px 10px;
            box-shadow: var(--scoreboard-boxShadow-cell);
            height: 40px;
            display: flex;
            align-items: center;
            font-family: 'Oswald', sans-serif;
            overflow: hidden;

            @include mobile {
                font-size: 22px;
                padding: 0px 4px;
                height: 32px;
            }

            &.rank {
                text-align: center;
                color: var(--green);
                display: flex;
                justify-content: center;
            }

            &.name {
                font-weight: 600;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
                margin: 0px $grid-name-margin;
                font-family: Oswald, Arial;

                .favorite-star {
                    font-size: 1rem;
                    margin-left: 4px;
                }

                @include mobile {
                    font-size: 22px;
                    margin: 0px 5px;
                }
            }

            &.score {
                display: flex;
                justify-content: center;
                color: var(--green);
                // font-size: 28px;

                &.under-par {
                    color: var(--red)
                }

                &.even-par {
                    color: var(--scoreboard-FC-row);
                }
            }

            &.total {
                margin-left: $grid-name-margin;

                @include mobile {
                    margin-left: 5px;
                }

                &.under-par {
                    color: var(--red);
                }

                &.even-par {
                    color: var(--scoreboard-FC-row);
                }

                &.over-par {
                    color: var(--green);
                }

                &.cut-text {
                    color: var(--scoreboard-FC-row-CUT);
                    font-weight: bold;
                    font-style: italic;
                    font-size: 24px;

                    @include mobile {
                        font-size: 20px;
                    }
                }
            }
        }
    }

    // FavoriteRow Styles
    &.favorite-row {
        .teamRow-container {
            background-color: var(--scoreboard-BG-row-favorite);

            .cell {
                background-color: var(--scoreboard-BG-cell-favorite);
            }

            &:hover {
                background-color: var(--scoreboard-BG-row-favorite--hover);

                .cell {
                    background-color: var(--scoreboard-BG-cell-favorite--hover);
                }
            }

        }
    }
}


// Timing Variables (Match your AnimatedCell.tsx constants)
$flash-duration: 0.6s;
$pause-duration: 0.3s;
$flip-duration: 1.2s;
$hold-after-duration: 0.8s;
$fade-out-duration: 0.2s;
$total-duration: $flash-duration + $pause-duration + $flip-duration + $hold-after-duration + $fade-out-duration;

// Percentage Calculations
$stage1-end: calc(($flash-duration / $total-duration) * 100%);
$stage2-end: calc((($flash-duration + $pause-duration) / $total-duration) * 100%);
$swap-point: calc((($flash-duration + $pause-duration + ($flip-duration / 2)) / $total-duration) * 100%);
$flip-end: calc((($flash-duration + $pause-duration + $flip-duration) / $total-duration) * 100%);
// The moment the "hold" ends and the "fade" begins
$fade-start: calc((($flash-duration + $pause-duration + $flip-duration + $hold-after-duration) / $total-duration) * 100%);

.cell {
    position: relative;

    &.is-animating-cell {
        // 'forwards' ensures it stays at the final keyframe until React removes the class
        animation: cellBackgroundFlash #{$total-duration} ease-in-out forwards;

        .score-tile-inner {
            animation: tileFlipSequence #{$total-duration} ease-in-out forwards;
        }
    }
}

.score-tile-inner {
    display: flex;
    width: 100%;
    justify-content: center;
    align-items: center;
    transform-style: preserve-3d;
    perspective: 1000px;
    backface-visibility: hidden;
}

// 1. Background Animation: Handles the fill of the .cell
@keyframes cellBackgroundFlash {

    // Stage 1: Flashing (Initial State -> Hover State -> Initial State)
    0%,
    #{$stage1-end * 0.5},
    #{$stage1-end} {
        background-color: var(--scoreboard-BG-row); // Start at row default
    }

    #{$stage1-end * 0.25},
    #{$stage1-end * 0.75} {
        background-color: var(--scoreboard-BG-row--hover);
    }

    // Stage 2 & 3: Flip (Transition to highlight at the swap point)
    #{$stage2-end} {
        background-color: var(--scoreboard-BG-row--hover);
    }

    #{$swap-point} {
        background-color: var(--scoreboard-BG-row--hover);
    }

    // Stage 4: Hold the highlight
    #{$fade-start} {
        background-color: var(--scoreboard-BG-row--hover);
    }

    // Stage 5: Fade back to original row color
    100% {
        background-color: var(--scoreboard-BG-row);
    }
}

// 2. 3D Flip Animation: Handles the perspective of the text
@keyframes tileFlipSequence {

    // Stay flat until flip starts
    0%,
    #{$stage2-end} {
        transform: rotateX(0deg);
        opacity: 1;
    }

    // Flip to 90 degrees (vertical)
    #{($swap-point - 0.01%)} {
        transform: rotateX(90deg);
        opacity: 1;
    }

    // Teleport to -90 degrees while invisible (this is when React swaps the value)
    #{$swap-point} {
        transform: rotateX(-90deg);
        opacity: 0;
    }

    // Finish the rotation back to 0
    #{$flip-end},
    100% {
        transform: rotateX(0deg);
        opacity: 1;
    }
}